<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
	<meta name="referrer" content="no-referrer" />
    <meta name="keywords" content="谷粒商城分布式微服务组件ELASTICSEARCH, Hexo">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>谷粒商城分布式微服务组件ELASTICSEARCH | Hexo</title>
    <link rel="icon" type="image/png" href="/f/favicon.png">

    <link rel="stylesheet" type="text/css" href="/f/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/f/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/f/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/f/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/f/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/f/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/f/css/my.css">

    <script src="/f/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/f/" class="waves-effect waves-light">
                    
                    <img src="/f/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/f/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/f/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/f/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/f/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/f/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/f/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/f/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/f/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/f/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/f/medias/featureimages/8.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">谷粒商城分布式微服务组件ELASTICSEARCH</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/f/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/f/tags/ELASTICSEARCH/">
                                <span class="chip bg-color">ELASTICSEARCH</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/f/categories/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" class="post-category">
                                谷粒商城
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-08-23
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    11k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    56 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/f/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-ELASTICSEARCH"><a href="#1-ELASTICSEARCH" class="headerlink" title="1. ELASTICSEARCH"></a>1. ELASTICSEARCH</h2><h3 id="1、安装elastic-search"><a href="#1、安装elastic-search" class="headerlink" title="1、安装elastic search"></a>1、安装elastic search</h3><p> dokcer中安装elastic search</p>
<p>（1）下载ealastic search和kibana</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull elasticsearch:7.6.2
docker pull kibana:7.6.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>（2）配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> -p /mydata/elasticsearch/config
<span class="token function">mkdir</span> -p /mydata/elasticsearch/data
<span class="token builtin class-name">echo</span> <span class="token string">"http.host: 0.0.0.0"</span> <span class="token operator">></span>/mydata/elasticsearch/config/elasticsearch.yml
<span class="token function">chmod</span> -R <span class="token number">777</span> /mydata/elasticsearch/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>（3）启动Elastic search</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>
-e  <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span>
-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx512m"</span> <span class="token punctuation">\</span>
-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\</span>
-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\</span>
-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span>
-d elasticsearch:7.6.2 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>设置开机启动elasticsearch</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker update elasticsearch --restart<span class="token operator">=</span>always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>（4）启动kibana：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://192.168.137.14:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.6.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置开机启动kibana</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker update kibana  --restart<span class="token operator">=</span>always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>（5）测试</p>
<p>查看elasticsearch版本信息： <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/">http://192.168.137.14:9200/</a> </p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"0adeb7852e00"</span><span class="token punctuation">,</span>
    <span class="token property">"cluster_name"</span><span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>
    <span class="token property">"cluster_uuid"</span><span class="token operator">:</span> <span class="token string">"9gglpP0HTfyOTRAaSe2rIg"</span><span class="token punctuation">,</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"number"</span><span class="token operator">:</span> <span class="token string">"7.6.2"</span><span class="token punctuation">,</span>
        <span class="token property">"build_flavor"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"build_type"</span><span class="token operator">:</span> <span class="token string">"docker"</span><span class="token punctuation">,</span>
        <span class="token property">"build_hash"</span><span class="token operator">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span><span class="token punctuation">,</span>
        <span class="token property">"build_date"</span><span class="token operator">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span><span class="token punctuation">,</span>
        <span class="token property">"build_snapshot"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"lucene_version"</span><span class="token operator">:</span> <span class="token string">"8.4.0"</span><span class="token punctuation">,</span>
        <span class="token property">"minimum_wire_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.8.0"</span><span class="token punctuation">,</span>
        <span class="token property">"minimum_index_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.0.0-beta1"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"tagline"</span><span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>显示elasticsearch 节点信息<a target="_blank" rel="noopener" href="http://192.168.137.14:9200/_cat/nodes">http://192.168.137.14:9200/_cat/nodes</a> ，</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token number">127.0</span>.<span class="token number">0.1</span> <span class="token number">76</span> <span class="token number">95</span> <span class="token number">1</span> <span class="token number">0.26</span> <span class="token number">1.40</span> <span class="token number">1.22</span> dilm * 0adeb7852e00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>访问Kibana： <a target="_blank" rel="noopener" href="http://192.168.137.14:5601/app/kibana">http://192.168.137.14:5601/app/kibana</a> </p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104906.png" alt="image-20200501192629304"></p>
<h3 id="2、初步检索"><a href="#2、初步检索" class="headerlink" title="2、初步检索"></a>2、初步检索</h3><h4 id="1）-CAT"><a href="#1）-CAT" class="headerlink" title="1）_CAT"></a>1）_CAT</h4><p>（1）GET/<em>cat/nodes：查看所有节点</em></p>
<p> 如：<a target="_blank" rel="noopener" href="http://192.168.137.14:9200/_cat/nodes">http://192.168.137.14:9200/_cat/nodes</a> :</p>
<pre class="line-numbers language-none"><code class="language-none">127.0.0.1 61 91 11 0.08 0.49 0.87 dilm * 0adeb7852e00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注：*表示集群中的主节点</p>
<p>（2）GET/<em>cat/health：查看es健康状况</em></p>
<p>如： <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/_cat/health">http://192.168.137.14:9200/_cat/health</a> </p>
<pre class="line-numbers language-none"><code class="language-none">1588332616 11:30:16 elasticsearch green 1 1 3 3 0 0 0 0 - 100.0%<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注：green表示健康值正常</p>
<p>（3）GET/<em>cat/master：查看主节点</em></p>
<p>如： <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/_cat/master">http://192.168.137.14:9200/_cat/master</a> </p>
<pre class="line-numbers language-none"><code class="language-none">vfpgxbusTC6-W3C2Np31EQ 127.0.0.1 127.0.0.1 0adeb7852e00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>（4）GET/_cat/indicies：查看所有索引 ，等价于mysql数据库的show databases;</p>
<p>如： <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/_cat/indices">http://192.168.137.14:9200/_cat/indices</a> </p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">green open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg <span class="token number">1</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">39</span>.8kb <span class="token number">39</span>.8kb
green open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>   283b   283b
green open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw <span class="token number">1</span> <span class="token number">0</span> <span class="token number">7</span> <span class="token number">0</span> <span class="token number">31</span>.2kb <span class="token number">31</span>.2kb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="2）索引一个文档"><a href="#2）索引一个文档" class="headerlink" title="2）索引一个文档"></a>2）索引一个文档</h4><p>保存一个数据，保存在哪个索引的哪个类型下，指定用那个唯一标识<br>PUT customer/external/1;在customer索引下的external类型下保存1号数据为</p>
<pre class="line-numbers language-none"><code class="language-none">PUT customer&#x2F;external&#x2F;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
 <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"John Doe"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>PUT和POST都可以<br>POST新增。如果不指定id，会自动生成id。指定id就会修改这个数据，并新增版本号；<br>PUT可以新增也可以修改。PUT必须指定id；由于PUT需要指定id，我们一般用来做修改操作，不指定id会报错。</p>
<p>下面是在postman中的测试数据：<br><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104913.png" alt="image-20200501194449944"></p>
<p>创建数据成功后，显示201 created表示插入记录成功。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"customer"</span><span class="token punctuation">,</span>
    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"external"</span><span class="token punctuation">,</span>
    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这些返回的JSON串的含义；这些带有下划线开头的，称为元数据，反映了当前的基本信息。</p>
<p>“_index”: “customer” 表明该数据在哪个数据库下；</p>
<p>“_type”: “external”     表明该数据在哪个类型下；</p>
<p>“_id”: “1”                    表明被保存数据的id；</p>
<p> “_version”: 1,            被保存数据的版本</p>
<p>“result”: “created”      这里是创建了一条数据，如果重新put一条数据，则该状态会变为updated，并且版本号也会发生变化。</p>
<p>下面选用POST方式：</p>
<p>添加数据的时候，不指定ID，会自动的生成id，并且类型是新增：</p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104917.png" alt="image-20200501195619925" style="zoom: 52%;" />

<p>再次使用POST插入数据，仍然是新增的：</p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104921.png" alt="image-20200501195732492" style="zoom: 80%;" />



<p>添加数据的时候，指定ID，会使用该id，并且类型是新增：</p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104925.png" alt="image-20200501200048361" style="zoom: 66%;" />

<p>再次使用POST插入数据，类型为updated</p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104928.png" alt="image-20200501200132199" style="zoom:67%;" />



<h4 id="3）查看文档"><a href="#3）查看文档" class="headerlink" title="3）查看文档"></a>3）查看文档</h4><p>GET /customer/external/1</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1">http://192.168.137.14:9200/customer/external/1</a> </p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"customer"</span><span class="token punctuation">,</span><span class="token comment">//在哪个索引</span>
    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"external"</span><span class="token punctuation">,</span><span class="token comment">//在哪个类型</span>
    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token comment">//记录id</span>
    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//版本号</span>
    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token comment">//并发控制字段，每次更新都会+1，用来做乐观锁</span>
    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">//同上，主分片重新分配，如重启，就会变化</span>
    <span class="token property">"found"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过“if_seq_no=1&amp;if_primary_term=1 ”，当序列号匹配的时候，才进行修改，否则不修改。</p>
<p>实例：将id=1的数据更新为name=1，然后再次更新为name=2，起始_seq_no=6，_primary_term=1</p>
<p>（1）将name更新为1</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1">http://192.168.137.14:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1</a> </p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104931.png" alt="image-20200501212224983" style="zoom: 61%;" />

<p> （2）将name更新为2，更新过程中使用seq_no=6</p>
<p><a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1">http://192.168.137.14:9200/customer/external/1?if_seq_no=6&amp;if_primary_term=1</a> </p>
<img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104935.png" alt="image-20200501213047499" style="zoom: 60%;" />

<p>出现更新错误。</p>
<p>（3）查询新的数据</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1">http://192.168.137.14:9200/customer/external/1</a> </p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824104941.png" alt="image-20200501212924094"></p>
<p>能够看到_seq_no变为7。</p>
<p>（4）再次更新，更新成功</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1?if_seq_no=7&amp;if_primary_term=1">http://192.168.137.14:9200/customer/external/1?if_seq_no=7&amp;if_primary_term=1</a> </p>
<h4 id="4）更新文档"><a href="#4）更新文档" class="headerlink" title="4）更新文档"></a>4）更新文档</h4><p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105005.png" alt="image-20200501214522818"></p>
<p> <img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105007.png" alt="image-20200501215746139"></p>
<p>（1）POST更新文档，带有_update</p>
<p><a target="_blank" rel="noopener" href="http://192.168.137.14:9200/customer/external/1/_update">http://192.168.137.14:9200/customer/external/1/_update</a> </p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105010.png" alt="image-20200501214810741"></p>
<p>如果再次执行更新，则不执行任何操作，序列号也不发生变化</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105013.png" alt="image-20200501214912607"></p>
<p>POST更新方式，会对比原来的数据，和原来的相同，则不执行任何操作（version和_seq_no）都不变。</p>
<p> （2）POST更新文档，不带_update</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105020.png" alt="image-20200501215358666"></p>
<p>在更新过程中，重复执行更新操作，数据也能够更新成功，不会和原来的数据进行对比。</p>
<h4 id="5）删除文档或索引"><a href="#5）删除文档或索引" class="headerlink" title="5）删除文档或索引"></a>5）删除文档或索引</h4><pre class="line-numbers language-none"><code class="language-none">DELETE customer&#x2F;external&#x2F;1
DELETE customer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注：elasticsearch并没有提供删除类型的操作，只提供了删除索引和文档的操作。</p>
<p>实例：删除id=1的数据，删除后继续查询</p>
<p>实例：删除整个costomer索引数据</p>
<p>删除前，所有的索引</p>
<pre class="line-numbers language-none"><code class="language-none">green  open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg 1 0 2 0 39.8kb 39.8kb
green  open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA 1 0 0 0   283b   283b
green  open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw 1 0 7 0 31.2kb 31.2kb
yellow open customer                 nzDYCdnvQjSsapJrAIT8Zw 1 1 4 0  4.4kb  4.4kb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>删除“ customer ”索引</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105044.png" alt="image-20200501221105476"></p>
<p>删除后，所有的索引</p>
<pre class="line-numbers language-none"><code class="language-none">green  open .kibana_task_manager_1   KWLtjcKRRuaV9so_v15WYg 1 0 2 0 39.8kb 39.8kb
green  open .apm-agent-configuration cuwCpJ5ER0OYsSgAJ7bVYA 1 0 0 0   283b   283b
green  open .kibana_1                PqK_LdUYRpWMy4fK0tMSPw 1 0 7 0 31.2kb 31.2kb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="6）eleasticsearch的批量操作——bulk"><a href="#6）eleasticsearch的批量操作——bulk" class="headerlink" title="6）eleasticsearch的批量操作——bulk"></a>6）eleasticsearch的批量操作——bulk</h4><p>语法格式：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>action<span class="token operator">:</span><span class="token punctuation">&#123;</span>metadata<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n
<span class="token punctuation">&#123;</span>request body  <span class="token punctuation">&#125;</span>\n

<span class="token punctuation">&#123;</span>action<span class="token operator">:</span><span class="token punctuation">&#123;</span>metadata<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n
<span class="token punctuation">&#123;</span>request body  <span class="token punctuation">&#125;</span>\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的批量操作，当发生某一条执行发生失败时，其他的数据仍然能够接着执行，也就是说彼此之间是独立的。</p>
<p>bulk api以此按顺序执行所有的action（动作）。如果一个单个的动作因任何原因失败，它将继续处理它后面剩余的动作。当bulk api返回时，它将提供每个动作的状态（与发送的顺序相同），所以您可以检查是否一个指定的动作是否失败了。</p>
<p>实例1: 执行多条数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST customer/external/_bulk
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"John Doe"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"John Doe"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行结果</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">#! Deprecation<span class="token operator">:</span> <span class="token punctuation">[</span>types removal<span class="token punctuation">]</span> Specifying types in bulk requests is deprecated.
<span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">491</span><span class="token punctuation">,</span>
  <span class="token property">"errors"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"items"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"customer"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"external"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">201</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"customer"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"external"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">201</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>实例2：对于整个索引执行批量操作</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST /_bulk
<span class="token punctuation">&#123;</span><span class="token property">"delete"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"website"</span><span class="token punctuation">,</span><span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"blog"</span><span class="token punctuation">,</span><span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"create"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"website"</span><span class="token punctuation">,</span><span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"blog"</span><span class="token punctuation">,</span><span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"my first blog post"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"website"</span><span class="token punctuation">,</span><span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"blog"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"my second blog post"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"update"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"website"</span><span class="token punctuation">,</span><span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"blog"</span><span class="token punctuation">,</span><span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"doc"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"my updated blog post"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">#! Deprecation<span class="token operator">:</span> <span class="token punctuation">[</span>types removal<span class="token punctuation">]</span> Specifying types in bulk requests is deprecated.
<span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">608</span><span class="token punctuation">,</span>
  <span class="token property">"errors"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"items"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"delete"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"not_found"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">404</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"create"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">201</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"MCOs0HEBHYK_MJXUyYIz"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">201</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"update"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>
        <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"updated"</span><span class="token punctuation">,</span>
        <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token number">200</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="7）样本测试数据"><a href="#7）样本测试数据" class="headerlink" title="7）样本测试数据"></a>7）样本测试数据</h4><p>准备了一份顾客银行账户信息的虚构的JSON文档样本。每个文档都有下列的schema（模式）。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">"balance"</span><span class="token operator">:</span> <span class="token number">39225</span><span class="token punctuation">,</span>
	<span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Amber"</span><span class="token punctuation">,</span>
	<span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Duke"</span><span class="token punctuation">,</span>
	<span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
	<span class="token property">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
	<span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"880 Holmes Lane"</span><span class="token punctuation">,</span>
	<span class="token property">"employer"</span><span class="token operator">:</span> <span class="token string">"Pyrami"</span><span class="token punctuation">,</span>
	<span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"amberduke@pyrami.com"</span><span class="token punctuation">,</span>
	<span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Brogan"</span><span class="token punctuation">,</span>
	<span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"IL"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json">https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json</a> ，导入测试数据，</p>
<p>POST bank/account/_bulk</p>
<h3 id="3、检索"><a href="#3、检索" class="headerlink" title="3、检索"></a>3、检索</h3><h4 id="1）search-Api"><a href="#1）search-Api" class="headerlink" title="1）search Api"></a>1）search Api</h4><p>ES支持两种基本方式检索；</p>
<ul>
<li>通过REST request uri 发送搜索参数 （uri +检索参数）；</li>
<li>通过REST request body 来发送它们（uri+请求体）；</li>
</ul>
<p>信息检索</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105052.png" alt="image-20200501233938697"></p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105055.png" alt="image-20200502000221422"></p>
<p><img src="images/image-20200502000733594.png" alt="image-20200502000733594"></p>
<p>uri+请求体进行检索</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> <span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token string">"asc"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token property">"balance"</span><span class="token operator">:</span><span class="token string">"desc"</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>HTTP客户端工具（），get请求不能够携带请求体，</p>
<pre class="line-numbers language-none"><code class="language-none">GET bank&#x2F;_search?q&#x3D;*&amp;sort&#x3D;account_number:asc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">235</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">16623</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Bradshaw"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Mckenzie"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"244 Columbus Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Euron"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"bradshawmckenzie@euron.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Hobucken"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"CO"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">0</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">39225</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Amber"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Duke"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"880 Holmes Lane"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pyrami"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"amberduke@pyrami.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Brogan"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"IL"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">1</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">28838</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Roberta"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Bender"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"560 Kingsway Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Chillium"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"robertabender@chillium.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Bennett"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"LA"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">2</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">44947</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Levine"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Burks"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"328 Wilson Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Amtap"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"levineburks@amtap.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Cochranville"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"HI"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">3</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">27658</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Rodriquez"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Flores"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"986 Wyckoff Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Tourmania"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"rodriquezflores@tourmania.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Eastvale"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"HI"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">4</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">29342</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Leola"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Stewart"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"311 Elm Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Diginetic"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"leolastewart@diginetic.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Fairview"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"NJ"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">5</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"6"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">5686</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Hattie"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Bond"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"671 Bristol Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Netagy"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"hattiebond@netagy.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Dante"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"TN"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">6</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"7"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">39121</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Levy"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Richard"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"820 Logan Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Teraprene"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"levyrichard@teraprene.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Shrewsbury"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"MO"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">7</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"8"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">48868</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Jan"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Burns"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"699 Visitation Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Glasstep"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"janburns@glasstep.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Wakulla"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AZ"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">8</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"9"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">24776</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Opal"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Meadows"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"963 Neptune Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Cedward"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"opalmeadows@cedward.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Olney"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"OH"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">9</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>（1）只有6条数据，这是因为存在分页查询；</p>
<p>（2）详细的字段信息，参照： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-search.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-search.html</a> </p>
<blockquote>
<p>The response also provides the following information about the search request:</p>
<ul>
<li><code>took</code> – how long it took Elasticsearch to run the query, in milliseconds</li>
<li><code>timed_out</code> – whether or not the search request timed out</li>
<li><code>_shards</code> – how many shards were searched and a breakdown of how many shards succeeded, failed, or were skipped.</li>
<li><code>max_score</code> – the score of the most relevant document found</li>
<li><code>hits.total.value</code> - how many matching documents were found</li>
<li><code>hits.sort</code> - the document’s sort position (when not sorting by relevance score)</li>
<li><code>hits._score</code> - the document’s relevance score (not applicable when using <code>match_all</code>)</li>
</ul>
</blockquote>
<h4 id="2）Query-DSL"><a href="#2）Query-DSL" class="headerlink" title="2）Query DSL"></a>2）Query DSL</h4><h5 id="（1）基本语法格式"><a href="#（1）基本语法格式" class="headerlink" title="（1）基本语法格式"></a>（1）基本语法格式</h5><p>Elasticsearch提供了一个可以执行查询的Json风格的DSL。这个被称为Query DSL，该查询语言非常全面。</p>
<p>一个查询语句的典型结构</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">QUERY_NAME<span class="token operator">:</span><span class="token punctuation">&#123;</span>
   ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>
   ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>...
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>如果针对于某个字段，那么它的结构如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  QUERY_NAME<span class="token operator">:</span><span class="token punctuation">&#123;</span>
     FIELD_NAME<span class="token operator">:</span><span class="token punctuation">&#123;</span>
       ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>
       ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>...
      <span class="token punctuation">&#125;</span>   
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"from"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>query定义如何查询；</p>
<ul>
<li>match_all查询类型【代表查询所有的所有】，es中可以在query中组合非常多的查询类型完成复杂查询；</li>
<li>除了query参数之外，我们可也传递其他的参数以改变查询结果，如sort，size；</li>
<li>from+size限定，完成分页功能；</li>
<li>sort排序，多字段排序，会在前序字段相等时后续字段内部排序，否则以前序为准；</li>
</ul>
<h5 id="（2）返回部分字段"><a href="#（2）返回部分字段" class="headerlink" title="（2）返回部分字段"></a>（2）返回部分字段</h5><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"from"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">,</span><span class="token string">"firstname"</span><span class="token punctuation">]</span>
  
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"999"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Dorothy"</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">6087</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">999</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"998"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Letha"</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">16869</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">998</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"997"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Combs"</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">25311</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">997</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"996"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Andrews"</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">17541</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">996</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"995"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Phelps"</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">21153</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">995</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="（3）match匹配查询"><a href="#（3）match匹配查询" class="headerlink" title="（3）match匹配查询"></a>（3）match匹配查询</h5><ul>
<li>基本类型（非字符串），精确控制</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token string">"20"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>match返回account_number=20的数据。</p>
<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">16418</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Elinor"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Ratliff"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"282 Kings Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Scentric"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"elinorratliff@scentric.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Ribera"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"WA"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<ul>
<li>字符串，全文检索</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"kings"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>全文检索，最终会按照评分进行排序，会对检索条件进行分词匹配。</p>
<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">5.990829</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.990829</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">16418</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Elinor"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Ratliff"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"282 Kings Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Scentric"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"elinorratliff@scentric.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Ribera"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"WA"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"722"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.990829</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">722</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">27256</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Roberts"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Beasley"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"305 Kings Hwy"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Quintity"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"robertsbeasley@quintity.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Hayden"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"PA"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="（4）-match-phrase-短句匹配"><a href="#（4）-match-phrase-短句匹配" class="headerlink" title="（4） match_phrase [短句匹配]"></a>（4） match_phrase [短句匹配]</h5><p>将需要匹配的值当成一整个单词（不分词）进行检索</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_phrase"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill road"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查处address中包含mill_road的所有记录，并给出相关性得分</p>
<p>查看结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">8.926605</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">8.926605</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>match_phrase和Match的区别，观察如下实例：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_phrase"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"990 Mill"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">10.806405</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">10.806405</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>使用match的keyword</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address.keyword"</span><span class="token operator">:</span> <span class="token string">"990 Mill"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果，一条也未匹配到</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>修改匹配条件为“990 Mill Road”</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address.keyword"</span><span class="token operator">:</span> <span class="token string">"990 Mill Road"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询出一条数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">6.5032897</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.5032897</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>文本字段的匹配，使用keyword，匹配的条件就是要显示字段的全部值，要进行精确匹配的。</p>
<p>match_phrase是做短语匹配，只要文本中包含匹配条件，就能匹配到。</p>
<h5 id="（5）multi-math【多字段匹配】"><a href="#（5）multi-math【多字段匹配】" class="headerlink" title="（5）multi_math【多字段匹配】"></a>（5）multi_math【多字段匹配】</h5><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"mill"</span><span class="token punctuation">,</span>
      <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"state"</span><span class="token punctuation">,</span>
        <span class="token string">"address"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>state或者address中包含mill，并且在查询过程中，会对于查询条件进行分词。</p>
<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"136"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">45801</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Winnie"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Holland"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"198 Mill Lane"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Neteria"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"winnieholland@neteria.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Urie"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"IL"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"345"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">345</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">9812</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Parker"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Hines"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"715 Mill Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Baluba"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"parkerhines@baluba.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Blackgum"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"KY"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"472"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">472</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">25571</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Lee"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Long"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"288 Mill Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Comverges"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"leelong@comverges.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Movico"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"MT"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="（6）bool用来做复合查询"><a href="#（6）bool用来做复合查询" class="headerlink" title="（6）bool用来做复合查询"></a>（6）bool用来做复合查询</h5><p>复合语句可以合并，任何其他查询语句，包括符合语句。这也就意味着，复合语句之间<br>可以互相嵌套，可以表达非常复杂的逻辑。</p>
<p>must：必须达到must所列举的所有条件</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
   <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"bool"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
             <span class="token property">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span>
              <span class="token punctuation">&#123;</span><span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"address"</span><span class="token operator">:</span><span class="token string">"mill"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
              <span class="token punctuation">&#123;</span><span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"gender"</span><span class="token operator">:</span><span class="token string">"M"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
             <span class="token punctuation">]</span>
         <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>must_not，必须不匹配must_not所列举的所有条件。</p>
<p>should，应该满足should所列举的条件。</p>
<p>实例：查询gender=m，并且address=mill的数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"136"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">45801</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Winnie"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Holland"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"198 Mill Lane"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Neteria"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"winnieholland@neteria.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Urie"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"IL"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"345"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">345</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">9812</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Parker"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Hines"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"715 Mill Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Baluba"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"parkerhines@baluba.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Blackgum"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"KY"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p><strong>must_not：必须不是指定的情况</strong></p>
<p>实例：查询gender=m，并且address=mill的数据，但是age不等于38的</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">
GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"age"</span><span class="token operator">:</span> <span class="token string">"38"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p><strong>should：应该达到should列举的条件，如果到达会增加相关文档的评分，并不会改变查询的结果。如果query中只有should且只有一种匹配规则，那么should的条件就会被作为默认匹配条件二区改变查询结果。</strong></p>
<p>实例：匹配lastName应该等于Wallace的数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"age"</span><span class="token operator">:</span> <span class="token string">"18"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"should"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Wallace"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">12.585751</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">12.585751</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"136"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">45801</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Winnie"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Holland"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"198 Mill Lane"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Neteria"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"winnieholland@neteria.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Urie"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"IL"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"345"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">6.0824604</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">345</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">9812</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Parker"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Hines"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"715 Mill Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Baluba"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"parkerhines@baluba.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Blackgum"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"KY"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>能够看到相关度越高，得分也越高。</p>
<h5 id="（7）Filter【结果过滤】"><a href="#（7）Filter【结果过滤】" class="headerlink" title="（7）Filter【结果过滤】"></a>（7）Filter【结果过滤】</h5><p>并不是所有的查询都需要产生分数，特别是哪些仅用于filtering过滤的文档。为了不计算分数，elasticsearch会自动检查场景并且优化查询的执行。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"gte"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>
            <span class="token property">"lte"</span><span class="token operator">:</span> <span class="token string">"20000"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里先是查询所有匹配address=mill的文档，然后再根据10000&lt;=balance&lt;=20000进行过滤查询结果</p>
<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"970"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">5.4032025</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">970</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19648</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Forbes"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Wallace"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"990 Mill Road"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pheast"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"forbeswallace@pheast.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Lopezo"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>Each <code>must</code>, <code>should</code>, and <code>must_not</code> element in a Boolean query is referred to as a query clause. How well a document meets the criteria in each <code>must</code> or <code>should</code> clause contributes to the document’s <em>relevance score</em>. The higher the score, the better the document matches your search criteria. By default, Elasticsearch returns documents ranked by these relevance scores.</p>
<p> 在boolean查询中，<code>must</code>, <code>should</code> 和<code>must_not</code> 元素都被称为查询子句 。 文档是否符合每个“must”或“should”子句中的标准，决定了文档的“相关性得分”。  得分越高，文档越符合您的搜索条件。  默认情况下，Elasticsearch返回根据这些相关性得分排序的文档。 </p>
<p>The criteria in a <code>must_not</code> clause is treated as a <em>filter</em>. It affects whether or not the document is included in the results, but does not contribute to how documents are scored. You can also explicitly specify arbitrary filters to include or exclude documents based on structured data.</p>
<p><code>“must_not”子句中的条件被视为“过滤器”。</code> 它影响文档是否包含在结果中，  但不影响文档的评分方式。  还可以显式地指定任意过滤器来包含或排除基于结构化数据的文档。 </p>
<p>filter在使用过程中，并不会计算相关性得分：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"gte"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>
            <span class="token property">"lte"</span><span class="token operator">:</span> <span class="token string">"20000"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">213</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">16418</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Elinor"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Ratliff"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"282 Kings Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Scentric"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"elinorratliff@scentric.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Ribera"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"WA"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"37"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">18612</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Mcgee"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Mooney"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"826 Fillmore Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Reversus"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"mcgeemooney@reversus.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Tooleville"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"OK"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"51"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">14097</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Burton"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Meyers"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"334 River Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Bezal"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"burtonmeyers@bezal.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Jacksonburg"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"MO"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"56"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">56</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">14992</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Josie"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Nelson"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"857 Tabor Court"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Emtrac"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"josienelson@emtrac.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Sunnyside"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"UT"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"121"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">121</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19594</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Acevedo"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Dorsey"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"479 Nova Court"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Netropic"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"acevedodorsey@netropic.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Islandia"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"CT"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"176"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">18607</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Kemp"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Walters"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"906 Howard Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Eyewax"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"kempwalters@eyewax.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Why"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"KY"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"183"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">183</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">14223</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Hudson"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"English"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"823 Herkimer Place"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Xinware"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"hudsonenglish@xinware.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Robbins"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"ND"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"222"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">222</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">14764</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Rachelle"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Rice"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"333 Narrows Avenue"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Enaut"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"rachellerice@enaut.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Wright"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"AZ"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"227"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">227</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19780</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Coleman"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Berg"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"776 Little Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Exoteric"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"colemanberg@exoteric.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Eagleville"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"WV"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"272"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">272</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">19253</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Lilly"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Morgan"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"689 Fleet Street"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Biolive"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"lillymorgan@biolive.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Sunbury"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"OH"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>能看到所有文档的 “_score” : 0.0。</strong></p>
<h5 id="（8）term"><a href="#（8）term" class="headerlink" title="（8）term"></a>（8）term</h5><p>和match一样。匹配某个属性的值。全文检索字段用match，其他非text字段匹配用term。</p>
<blockquote>
<p>Avoid using the <code>term</code> query for <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/text.html"><code>text</code></a> fields.</p>
<p>避免对文本字段使用“term”查询</p>
<p>By default, Elasticsearch changes the values of <code>text</code> fields as part of <a href="">analysis</a>. This can make finding exact matches for <code>text</code> field values difficult.</p>
<p>默认情况下，Elasticsearch作为<a href="">analysis</a>的一部分更改’ text ‘字段的值。这使得为“text”字段值寻找精确匹配变得困难。 </p>
<p>To search <code>text</code> field values, use the match.</p>
<p>要搜索“text”字段值，请使用匹配。</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/query-dsl-term-query.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/query-dsl-term-query.html</a> </p>
</blockquote>
<p>使用term匹配查询</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"mill Road"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一条也没有匹配到</p>
<p>而更换为match匹配时，能够匹配到32个文档</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105108.png" alt="image-20200502120921830"></p>
<p>也就是说，<strong>全文检索字段用match，其他非text字段匹配用term</strong>。</p>
<h5 id="（9）Aggregation（执行聚合）"><a href="#（9）Aggregation（执行聚合）" class="headerlink" title="（9）Aggregation（执行聚合）"></a>（9）Aggregation（执行聚合）</h5><p>聚合提供了从数据中分组和提取数据的能力。最简单的聚合方法大致等于SQL Group by和SQL聚合函数。在elasticsearch中，执行搜索返回this（命中结果），并且同时返回聚合结果，把以响应中的所有hits（命中结果）分隔开的能力。这是非常强大且有效的，你可以执行查询和多个聚合，并且在一次使用中得到各自的（任何一个的）返回结果，使用一次简洁和简化的API啦避免网络往返。</p>
<p>“size”:0</p>
<p>size:0不显示搜索数据<br>aggs：执行聚合。聚合语法如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"aggs"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
    <span class="token property">"aggs_name这次聚合的名字，方便展示在结果集中"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"AGG_TYPE聚合的类型(avg,term,terms)"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>，<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<p><strong>搜索address中包含mill的所有人的年龄分布以及平均年龄，但不显示这些人的详情</strong></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"Mill"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"ageAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"balanceAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查询结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"doc_count_error_upper_bound"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"sum_other_doc_count"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"buckets"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">34.0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"balanceAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">25208.0</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>复杂：<br>按照年龄聚合，并且求这些年龄段的这些人的平均薪资</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"ageAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"doc_count_error_upper_bound"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"sum_other_doc_count"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"buckets"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">28312.918032786885</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">25269.583333333332</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">59</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">23194.813559322032</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">52</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">23951.346153846152</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">52</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">22136.69230769231</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">52</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">22174.71153846154</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">24731.07843137255</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">28273.882352941175</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">25093.94</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">26809.95918367347</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">22841.106382978724</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">46</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">26981.434782608696</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">27183.17777777778</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">27741.227272727272</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">27314.214285714286</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">28519.04761904762</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">27445.214285714286</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">27022.261904761905</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">21471.871794871793</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">26187.17948717949</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
          <span class="token property">"ageAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">29483.14285714286</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查出所有年龄分布，并且这些年龄段中M的平均薪资和F的平均薪资以及这个年龄段的总体平均薪资</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"genderAgg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"gender.keyword"</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"balanceAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"ageBalanceAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">119</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"doc_count_error_upper_bound"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"sum_other_doc_count"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"buckets"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span>
          <span class="token property">"genderAgg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"doc_count_error_upper_bound"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"sum_other_doc_count"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"buckets"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">&#123;</span>
                <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
                <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
                <span class="token property">"balanceAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                  <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">29565.628571428573</span>
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
              <span class="token punctuation">&#123;</span>
                <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span>
                <span class="token property">"doc_count"</span> <span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
                <span class="token property">"balanceAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                  <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">26626.576923076922</span>
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token property">"ageBalanceAvg"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">28312.918032786885</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
        .......<span class="token comment">//省略其他</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3）Mapping"><a href="#3）Mapping" class="headerlink" title="3）Mapping"></a>3）Mapping</h4><h5 id="（1）字段类型"><a href="#（1）字段类型" class="headerlink" title="（1）字段类型"></a>（1）字段类型</h5><p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105114.png" alt="image-20200502161339291"></p>
<h5 id="（2）映射"><a href="#（2）映射" class="headerlink" title="（2）映射"></a>（2）映射</h5><p>Mapping(映射)<br>Maping是用来定义一个文档（document），以及它所包含的属性（field）是如何存储和索引的。比如：使用maping来定义：</p>
<ul>
<li><p>哪些字符串属性应该被看做全文本属性（full text fields）；</p>
</li>
<li><p>哪些属性包含数字，日期或地理位置；</p>
</li>
<li><p>文档中的所有属性是否都嫩被索引（all 配置）；</p>
</li>
<li><p>日期的格式；</p>
</li>
<li><p>自定义映射规则来执行动态添加属性；</p>
</li>
<li><p>查看mapping信息<br>GET bank/_mapping</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"bank"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"mappings"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>修改mapping信息</p>
</li>
</ul>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105120.png" alt="image-20200502170924399"></p>
<h5 id="（3）新版本改变"><a href="#（3）新版本改变" class="headerlink" title="（3）新版本改变"></a>（3）新版本改变</h5><p>ElasticSearch7-去掉type概念</p>
<ol>
<li><p>关系型数据库中两个数据表示是独立的，即使他们里面有相同名称的列也不影响使用，但ES中不是这样的。elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。</p>
<ul>
<li>两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。</li>
<li>去掉type就是为了提高ES处理数据的效率。</li>
</ul>
</li>
<li><p>Elasticsearch 7.x URL中的type参数为可选。比如，索引一个文档不再要求提供文档类型。</p>
</li>
<li><p>Elasticsearch 8.x 不再支持URL中的type参数。</p>
</li>
<li><p>解决：<br>将索引从多类型迁移到单类型，每种类型文档一个独立索引</p>
<p>将已存在的索引下的类型数据，全部迁移到指定位置即可。详见数据迁移</p>
</li>
</ol>
<blockquote>
<p><strong>Elasticsearch 7.x</strong></p>
<ul>
<li>Specifying types in requests is deprecated. For instance, indexing a document no longer requires a document <code>type</code>. The new index APIs are <code>PUT &#123;index&#125;/_doc/&#123;id&#125;</code> in case of explicit ids and <code>POST &#123;index&#125;/_doc</code> for auto-generated ids. Note that in 7.0, <code>_doc</code> is a permanent part of the path, and represents the endpoint name rather than the document type.</li>
<li>The <code>include_type_name</code> parameter in the index creation, index template, and mapping APIs will default to <code>false</code>. Setting the parameter at all will result in a deprecation warning.</li>
<li>The <code>_default_</code> mapping type is removed.</li>
</ul>
<p><strong>Elasticsearch 8.x</strong></p>
<ul>
<li>Specifying types in requests is no longer supported.</li>
<li>The <code>include_type_name</code> parameter is removed.</li>
</ul>
</blockquote>
<h6 id="创建映射"><a href="#创建映射" class="headerlink" title="创建映射"></a>创建映射</h6><p>创建索引并指定映射</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /my_index
<span class="token punctuation">&#123;</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"age"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"email"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 输出：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"shards_acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token string">"my_index"</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="查看映射"><a href="#查看映射" class="headerlink" title="查看映射"></a>查看映射</h6><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /my_index<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"my_index"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"aliases"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"mappings"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"integer"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"employee-id"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
          <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"settings"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"creation_date"</span> <span class="token operator">:</span> <span class="token string">"1588410780774"</span><span class="token punctuation">,</span>
        <span class="token property">"number_of_shards"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"number_of_replicas"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"uuid"</span> <span class="token operator">:</span> <span class="token string">"ua0lXhtkQCOmn7Kh3iUu0w"</span><span class="token punctuation">,</span>
        <span class="token property">"version"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"created"</span> <span class="token operator">:</span> <span class="token string">"7060299"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"provided_name"</span> <span class="token operator">:</span> <span class="token string">"my_index"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h6 id="添加新的字段映射"><a href="#添加新的字段映射" class="headerlink" title="添加新的字段映射"></a>添加新的字段映射</h6><pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /my_index/_mapping
<span class="token punctuation">&#123;</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"employee-id"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
      <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的 “index”: false，表明新增的字段不能被检索，只是一个冗余字段。</p>
<h6 id="更新映射"><a href="#更新映射" class="headerlink" title="更新映射"></a>更新映射</h6><p>对于已经存在的字段映射，我们不能更新。更新必须创建新的索引，进行数据迁移。</p>
<h6 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h6><p>先创建new_twitter的正确映射。然后使用如下方式进行数据迁移。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST reindex <span class="token punctuation">[</span>固定写法<span class="token punctuation">]</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"source"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span><span class="token operator">:</span><span class="token string">"twitter"</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"dest"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span><span class="token operator">:</span><span class="token string">"new_twitters"</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>将旧索引的type下的数据进行迁移</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST reindex <span class="token punctuation">[</span>固定写法<span class="token punctuation">]</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"source"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span><span class="token operator">:</span><span class="token string">"twitter"</span><span class="token punctuation">,</span>
      <span class="token property">"twitter"</span><span class="token operator">:</span><span class="token string">"twitter"</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"dest"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
      <span class="token property">"index"</span><span class="token operator">:</span><span class="token string">"new_twitters"</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>更多详情见： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html</a> </p>
<p>GET /bank/_search</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span><span class="token comment">//类型为account</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"account_number"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"balance"</span> <span class="token operator">:</span> <span class="token number">39225</span><span class="token punctuation">,</span>
          <span class="token property">"firstname"</span> <span class="token operator">:</span> <span class="token string">"Amber"</span><span class="token punctuation">,</span>
          <span class="token property">"lastname"</span> <span class="token operator">:</span> <span class="token string">"Duke"</span><span class="token punctuation">,</span>
          <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
          <span class="token property">"gender"</span> <span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
          <span class="token property">"address"</span> <span class="token operator">:</span> <span class="token string">"880 Holmes Lane"</span><span class="token punctuation">,</span>
          <span class="token property">"employer"</span> <span class="token operator">:</span> <span class="token string">"Pyrami"</span><span class="token punctuation">,</span>
          <span class="token property">"email"</span> <span class="token operator">:</span> <span class="token string">"amberduke@pyrami.com"</span><span class="token punctuation">,</span>
          <span class="token property">"city"</span> <span class="token operator">:</span> <span class="token string">"Brogan"</span><span class="token punctuation">,</span>
          <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token string">"IL"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">GET &#x2F;bank&#x2F;_search<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="images/image-20200502174825233.png" alt="image-20200502174825233"></p>
<p>想要将年龄修改为integer</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /newbank
<span class="token punctuation">&#123;</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"age"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"balance"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"city"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"email"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"employer"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"gender"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"keyword"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
            <span class="token property">"ignore_above"</span><span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"state"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看“newbank”的映射：</p>
<p>GET /newbank/_mapping</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105128.png" alt="image-20200502175901959"></p>
<p>能够看到age的映射类型被修改为了integer.</p>
<p>将bank中的数据迁移到newbank中</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST _reindex
<span class="token punctuation">&#123;</span>
  <span class="token property">"source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"account"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"dest"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"newbank"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行输出：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">#! Deprecation<span class="token operator">:</span> <span class="token punctuation">[</span>types removal<span class="token punctuation">]</span> Specifying types in reindex requests is deprecated.
<span class="token punctuation">&#123;</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">768</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token property">"updated"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"created"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token property">"deleted"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"batches"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"version_conflicts"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"noops"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"retries"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"bulk"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"search"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"throttled_millis"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"requests_per_second"</span> <span class="token operator">:</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
  <span class="token property">"throttled_until_millis"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"failures"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>查看newbank中的数据</p>
<p><img src="images/image-20200502181432745.png" alt="image-20200502181432745"></p>
<h4 id="4）分词"><a href="#4）分词" class="headerlink" title="4）分词"></a>4）分词</h4><p>一个tokenizer（分词器）接收一个字符流，将之分割为独立的tokens（词元，通常是独立的单词），然后输出tokens流。</p>
<p>例如：whitespace tokenizer遇到空白字符时分割文本。它会将文本“Quick brown fox!”分割为[Quick,brown,fox!]。</p>
<p>该tokenizer（分词器）还负责记录各个terms(词条)的顺序或position位置（用于phrase短语和word proximity词近邻查询），以及term（词条）所代表的原始word（单词）的start（起始）和end（结束）的character offsets（字符串偏移量）（用于高亮显示搜索的内容）。</p>
<p>elasticsearch提供了很多内置的分词器，可以用来构建custom analyzers（自定义分词器）。</p>
<p>关于分词器： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/analysis.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.6/analysis.html</a> </p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST _analyze
<span class="token punctuation">&#123;</span>
  <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span><span class="token punctuation">,</span>
  <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"The 2 QUICK Brown-Foxes jumped over the lazy dog's bone."</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"the"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;NUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"quick"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"brown"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"foxes"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"jumped"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">5</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"over"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">6</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"the"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">7</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"lazy"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">8</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"dog's"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">9</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"bone"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="（1）安装ik分词器"><a href="#（1）安装ik分词器" class="headerlink" title="（1）安装ik分词器"></a>（1）安装ik分词器</h5><p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105134.png" alt="image-20200502182929583"></p>
<p>所有的语言分词，默认使用的都是“Standard Analyzer”，但是这些分词器针对于中文的分词，并不友好。为此需要安装中文的分词器。</p>
<p>注意：不能用默认elasticsearch-plugin install xxx.zip 进行自动安装<br><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download">https://github.com/medcl/elasticsearch-analysis-ik/releases/download</a> 对应es版本安装</p>
<p>在前面安装的elasticsearch时，我们已经将elasticsearch容器的“/usr/share/elasticsearch/plugins”目录，映射到宿主机的“ /mydata/elasticsearch/plugins”目录下，所以比较方便的做法就是下载“/elasticsearch-analysis-ik-7.6.2.zip”文件，然后解压到该文件夹下即可。安装完毕后，需要重启elasticsearch容器。</p>
<p>如果不嫌麻烦，还可以采用如下的方式。</p>
<h6 id="（1）查看elasticsearch版本号："><a href="#（1）查看elasticsearch版本号：" class="headerlink" title="（1）查看elasticsearch版本号："></a>（1）查看elasticsearch版本号：</h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># curl http://localhost:9200</span>
<span class="token punctuation">&#123;</span>
  <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"0adeb7852e00"</span>,
  <span class="token string">"cluster_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"elasticsearch"</span>,
  <span class="token string">"cluster_uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"9gglpP0HTfyOTRAaSe2rIg"</span>,
  <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"number"</span> <span class="token builtin class-name">:</span> <span class="token string">"7.6.2"</span>,      <span class="token comment">#版本号为7.6.2</span>
    <span class="token string">"build_flavor"</span> <span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
    <span class="token string">"build_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker"</span>,
    <span class="token string">"build_hash"</span> <span class="token builtin class-name">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,
    <span class="token string">"build_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span>,
    <span class="token string">"build_snapshot"</span> <span class="token builtin class-name">:</span> false,
    <span class="token string">"lucene_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"8.4.0"</span>,
    <span class="token string">"minimum_wire_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.8.0"</span>,
    <span class="token string">"minimum_index_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.0.0-beta1"</span>
  <span class="token punctuation">&#125;</span>,
  <span class="token string">"tagline"</span> <span class="token builtin class-name">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="（2）进入es容器内部plugin目录"><a href="#（2）进入es容器内部plugin目录" class="headerlink" title="（2）进入es容器内部plugin目录"></a>（2）进入es容器内部plugin目录</h6><ul>
<li>docker exec -it 容器id /bin/bash</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it elasticsearch /bin/bash</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>wget  <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip</a></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/usr/share/elasticsearch
<span class="token comment">#下载ik7.6.2</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>unzip 下载的文件</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># unzip elasticsearch-analysis-ik-7.6.2.zip -d ink</span>
Archive:  elasticsearch-analysis-ik-7.6.2.zip
   creating: ik/config/
  inflating: ik/config/main.dic      
  inflating: ik/config/quantifier.dic  
  inflating: ik/config/extra_single_word_full.dic  
  inflating: ik/config/IKAnalyzer.cfg.xml  
  inflating: ik/config/surname.dic   
  inflating: ik/config/suffix.dic    
  inflating: ik/config/stopword.dic  
  inflating: ik/config/extra_main.dic  
  inflating: ik/config/extra_stopword.dic  
  inflating: ik/config/preposition.dic  
  inflating: ik/config/extra_single_word_low_freq.dic  
  inflating: ik/config/extra_single_word.dic  
  inflating: ik/elasticsearch-analysis-ik-7.6.2.jar  
  inflating: ik/httpclient-4.5.2.jar  
  inflating: ik/httpcore-4.4.4.jar   
  inflating: ik/commons-logging-1.2.jar  
  inflating: ik/commons-codec-1.9.jar  
  inflating: ik/plugin-descriptor.properties  
  inflating: ik/plugin-security.policy  
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#移动到plugins目录下</span>
<span class="token punctuation">[</span>root@0adeb7852e00 elasticsearch<span class="token punctuation">]</span><span class="token comment"># mv ik plugins/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>rm -rf *.zip</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">[root@0adeb7852e00 elasticsearch]# rm -rf elasticsearch-analysis-ik-7.6.2.zip <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>确认是否安装好了分词器</p>
<h5 id="（2）测试分词器"><a href="#（2）测试分词器" class="headerlink" title="（2）测试分词器"></a>（2）测试分词器</h5><p>使用默认</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET my_index/_analyze
<span class="token punctuation">&#123;</span>
   <span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"我是中国人"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>请观察执行结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"我"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;IDEOGRAPHIC>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"是"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;IDEOGRAPHIC>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"中"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;IDEOGRAPHIC>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"国"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;IDEOGRAPHIC>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"人"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;IDEOGRAPHIC>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET my_index/_analyze
<span class="token punctuation">&#123;</span>
   <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_smart"</span><span class="token punctuation">,</span> 
   <span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"我是中国人"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"我"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_CHAR"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"是"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_CHAR"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"中国人"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET my_index/_analyze
<span class="token punctuation">&#123;</span>
   <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span> 
   <span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"我是中国人"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"我"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_CHAR"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"是"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_CHAR"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"中国人"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"中国"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"国人"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="（3）自定义词库"><a href="#（3）自定义词库" class="headerlink" title="（3）自定义词库"></a>（3）自定义词库</h5><ul>
<li>修改/usr/share/elasticsearch/plugins/ik/config中的IKAnalyzer.cfg.xml<br>/usr/share/elasticsearch/plugins/ik/config</li>
</ul>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">"http://java.sun.com/dtd/properties.dtd"</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">></span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">></span></span>
	<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_dict<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>
	 <span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_stopwords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remote_ext_dict<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>http://192.168.137.14/es/fenci.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span> 
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--></span>
	<span class="token comment">&lt;!-- &lt;entry key="remote_ext_stopwords">words_location&lt;/entry> --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>原来的xml</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">"http://java.sun.com/dtd/properties.dtd"</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">></span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">></span></span>
	<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_dict<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>
	 <span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_stopwords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --></span>
	<span class="token comment">&lt;!-- &lt;entry key="remote_ext_dict">words_location&lt;/entry> --></span>
	<span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--></span>
	<span class="token comment">&lt;!-- &lt;entry key="remote_ext_stopwords">words_location&lt;/entry> --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改完成后，需要重启elasticsearch容器，否则修改不生效。</p>
<p>更新完成后，es只会对于新增的数据用更新分词。历史数据是不会重新分词的。如果想要历史数据重新分词，需要执行：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">POST my_index/_update_by_query?conflicts<span class="token operator">=</span>proceed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p><a target="_blank" rel="noopener" href="http://192.168.137.14/es/fenci.txt%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%98%AFnginx%E4%B8%8A%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84">http://192.168.137.14/es/fenci.txt，这个是nginx上资源的访问路径</a></p>
<p>在运行下面实例之前，需要安装nginx（安装方法见安装nginx），然后创建“fenci.txt”文件，内容如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"樱桃萨其马，带你甜蜜入夏"</span> <span class="token operator">></span> /mydata/nginx/html/fenci.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试效果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET my_index/_analyze
<span class="token punctuation">&#123;</span>
   <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span> 
   <span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"樱桃萨其马，带你甜蜜入夏"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"樱桃"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"萨其马"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"带你"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"甜蜜"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"入夏"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"CN_WORD"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="4、elasticsearch-Rest-Client"><a href="#4、elasticsearch-Rest-Client" class="headerlink" title="4、elasticsearch-Rest-Client"></a>4、elasticsearch-Rest-Client</h3><h4 id="1）9300-TCP"><a href="#1）9300-TCP" class="headerlink" title="1）9300: TCP"></a>1）9300: TCP</h4><ul>
<li><p>spring-data-elasticsearch:transport-api.jar;</p>
<ul>
<li>springboot版本不同，ransport-api.jar不同，不能适配es版本</li>
<li>7.x已经不建议使用，8以后就要废弃<h4 id="2）9200-HTTP"><a href="#2）9200-HTTP" class="headerlink" title="2）9200: HTTP"></a>2）9200: HTTP</h4></li>
</ul>
</li>
<li><p>jestClient: 非官方，更新慢；</p>
</li>
<li><p>RestTemplate：模拟HTTP请求，ES很多操作需要自己封装，麻烦；</p>
</li>
<li><p>HttpClient：同上；</p>
</li>
<li><p>Elasticsearch-Rest-Client：官方RestClient，封装了ES操作，API层次分明，上手简单；<br>最终选择Elasticsearch-Rest-Client（elasticsearch-rest-high-level-client）；<br> <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html</a> </p>
</li>
</ul>
<h3 id="5、附录：安装Nginx"><a href="#5、附录：安装Nginx" class="headerlink" title="5、附录：安装Nginx"></a>5、附录：安装Nginx</h3><ul>
<li><p>随便启动一个nginx实例，只是为了复制出配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -p80:80 --name nginx -d nginx:1.10   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>将容器内的配置文件拷贝到/mydata/nginx/conf/ 下</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> -p /mydata/nginx/html
<span class="token function">mkdir</span> -p /mydata/nginx/logs
<span class="token function">mkdir</span> -p /mydata/nginx/conf
docker container <span class="token function">cp</span> nginx:/etc/nginx/*  /mydata/nginx/conf/ 
<span class="token comment">#由于拷贝完成后会在config中存在一个nginx文件夹，所以需要将它的内容移动到conf中</span>
<span class="token function">mv</span> /mydata/nginx/conf/nginx/* /mydata/nginx/conf/
<span class="token function">rm</span> -rf /mydata/nginx/conf/nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>终止原容器：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker stop nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>执行命令删除原容器：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker <span class="token function">rm</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>创建新的Nginx，执行以下命令</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation">\</span>
 -v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\</span>
 -v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation">\</span>
 -v /mydata/nginx/conf/:/etc/nginx <span class="token punctuation">\</span>
 -d nginx:1.10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>设置开机启动nginx</p>
<pre class="line-numbers language-none"><code class="language-none">docker update nginx --restart&#x3D;always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>创建“/mydata/nginx/html/index.html”文件，测试是否能够正常访问</p>
<pre class="line-numbers language-none"><code class="language-none">echo &#39;&lt;h2&gt;hello nginx!&lt;&#x2F;h2&gt;&#39; &gt;index.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问：<a target="_blank" rel="noopener" href="http://ngix所在主机的ip/index.html">http://ngix所在主机的IP:80/index.html</a></p>
</li>
</ul>
<h2 id="SpringBoot整合ElasticSearch"><a href="#SpringBoot整合ElasticSearch" class="headerlink" title="SpringBoot整合ElasticSearch"></a>SpringBoot整合ElasticSearch</h2><h3 id="1、导入依赖"><a href="#1、导入依赖" class="headerlink" title="1、导入依赖"></a>1、导入依赖</h3><p>这里的版本要和所按照的ELK版本匹配。</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>7.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>在spring-boot-dependencies中所依赖的ELK版本位6.8.7</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;elasticsearch.version&gt;6.8.7&lt;&#x2F;elasticsearch.version&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105145.png" alt="image-20200511074437763"></p>
<p>需要在项目中将它改为7.6.2</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elasticsearch.version</span><span class="token punctuation">></span></span>7.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elasticsearch.version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2、编写测试类"><a href="#2、编写测试类" class="headerlink" title="2、编写测试类"></a>2、编写测试类</h3><h4 id="1）测试保存数据"><a href="#1）测试保存数据" class="headerlink" title="1）测试保存数据"></a>1）测试保存数据</h4><p> <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-document-index.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-document-index.html</a> </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">indexData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span> <span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> jsonString <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置要保存的内容</span>
    indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行创建索引和保存数据</span>
    <span class="token class-name">IndexResponse</span> index <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticSearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>测试前：</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105156.png" alt="image-20200511111618183"></p>
<p>测试后：</p>
<p><img src="https://gitee.com/fengylf/pubtypora/raw/master/img/20210824105200.png" alt="image-20200511112025327"></p>
<h4 id="2）测试获取数据"><a href="#2）测试获取数据" class="headerlink" title="2）测试获取数据"></a>2）测试获取数据</h4><p> <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html</a> </p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void searchData() throws IOException &#123;
    GetRequest getRequest &#x3D; new GetRequest(
            &quot;users&quot;,
            &quot;_-2vAHIB0nzmLJLkxKWk&quot;);

    GetResponse getResponse &#x3D; client.get(getRequest, RequestOptions.DEFAULT);
    System.out.println(getResponse);
    String index &#x3D; getResponse.getIndex();
    System.out.println(index);
    String id &#x3D; getResponse.getId();
    System.out.println(id);
    if (getResponse.isExists()) &#123;
        long version &#x3D; getResponse.getVersion();
        System.out.println(version);
        String sourceAsString &#x3D; getResponse.getSourceAsString();
        System.out.println(sourceAsString);
        Map&lt;String, Object&gt; sourceAsMap &#x3D; getResponse.getSourceAsMap();
        System.out.println(sourceAsMap);
        byte[] sourceAsBytes &#x3D; getResponse.getSourceAsBytes();
    &#125; else &#123;

    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>查询state=”AK”的文档：</p>
<pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
			<span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>   <span class="token comment">//匹配到了22条</span>
			<span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">3.7952394</span><span class="token punctuation">,</span>
		<span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
			<span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
			<span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"account"</span><span class="token punctuation">,</span>
			<span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"210"</span><span class="token punctuation">,</span>
			<span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">3.7952394</span><span class="token punctuation">,</span>
			<span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
				<span class="token property">"account_number"</span><span class="token operator">:</span> <span class="token number">210</span><span class="token punctuation">,</span>
				<span class="token property">"balance"</span><span class="token operator">:</span> <span class="token number">33946</span><span class="token punctuation">,</span>
				<span class="token property">"firstname"</span><span class="token operator">:</span> <span class="token string">"Cherry"</span><span class="token punctuation">,</span>
				<span class="token property">"lastname"</span><span class="token operator">:</span> <span class="token string">"Carey"</span><span class="token punctuation">,</span>
				<span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
				<span class="token property">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span>
				<span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"539 Tiffany Place"</span><span class="token punctuation">,</span>
				<span class="token property">"employer"</span><span class="token operator">:</span> <span class="token string">"Martgo"</span><span class="token punctuation">,</span>
				<span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"cherrycarey@martgo.com"</span><span class="token punctuation">,</span>
				<span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Fairacres"</span><span class="token punctuation">,</span>
				<span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AK"</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
           ....<span class="token comment">//省略其他</span>
          <span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>搜索address中包含mill的所有人的年龄分布以及平均年龄，平均薪资</strong></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET bank/_search
<span class="token punctuation">&#123;</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"Mill"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"ageAgg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"ageAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"balanceAvg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>java实现</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 复杂检索:在bank中搜索address中包含mill的所有人的年龄分布以及平均年龄，平均薪资
 * @throws IOException
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//1. 创建检索请求</span>
    <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1.1）指定索引</span>
    searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">"bank"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.2）构造检索条件</span>
    <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span><span class="token string">"Mill"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1.2.1)按照年龄分布进行聚合</span>
    <span class="token class-name">TermsAggregationBuilder</span> ageAgg<span class="token operator">=</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">"ageAgg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>ageAgg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1.2.2)计算平均年龄</span>
    <span class="token class-name">AvgAggregationBuilder</span> ageAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">"ageAvg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>ageAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.2.3)计算平均薪资</span>
    <span class="token class-name">AvgAggregationBuilder</span> balanceAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">"balanceAvg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"balance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>balanceAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"检索条件："</span><span class="token operator">+</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2. 执行检索</span>
    <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"检索结果："</span><span class="token operator">+</span>searchResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//3. 将检索结果封装为Bean</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> searchHit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> searchHit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Account</span> account <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token comment">//4. 获取聚合信息</span>
    <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Terms</span> ageAgg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"ageAgg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> ageAgg1<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"年龄："</span><span class="token operator">+</span>keyAsString<span class="token operator">+</span><span class="token string">" ==> "</span><span class="token operator">+</span>bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">Avg</span> ageAvg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"ageAvg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"平均年龄："</span><span class="token operator">+</span>ageAvg1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Avg</span> balanceAvg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"balanceAvg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"平均薪资："</span><span class="token operator">+</span>balanceAvg1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以尝试对比打印的条件和执行结果，和前面的ElasticSearch的检索语句和检索结果进行比较；</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-kibana控制台命令"><a href="#1-kibana控制台命令" class="headerlink" title="1. kibana控制台命令"></a>1. kibana控制台命令</h3><p>ctrl+home：回到文档首部；</p>
<p>ctril+end：回到文档尾部。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/f/about" rel="external nofollow noreferrer">摩托</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://fengylf.github.io/f/f/2021/08/23/note/springboot/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8Eelastic%20search/">https://fengylf.github.io/f/f/2021/08/23/note/springboot/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8Eelastic%20search/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/f/about" target="_blank">摩托</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/f/tags/ELASTICSEARCH/">
                                    <span class="chip bg-color">ELASTICSEARCH</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/f/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/f/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/f/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/f/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/f/2021/08/23/note/springboot/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4K8s/">
                    <div class="card-image">
                        
                        
                        <img src="/f/medias/featureimages/9.jpg" class="responsive-img" alt="谷粒商城分布式微服务组件K8s">
                        
                        <span class="card-title">谷粒商城分布式微服务组件K8s</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/f/categories/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" class="post-category">
                                    谷粒商城
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/f/tags/K8s/">
                        <span class="chip bg-color">K8s</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/f/2021/08/22/note/%E5%B7%A5%E5%85%B7/maven/">
                    <div class="card-image">
                        
                        
                        <img src="/f/medias/featureimages/19.jpg" class="responsive-img" alt="maven">
                        
                        <span class="card-title">maven</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-08-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/f/categories/maven/" class="post-category">
                                    maven
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/f/tags/maven/">
                        <span class="chip bg-color">maven</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/f/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/f/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/f/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/f/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/f/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/f/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/f/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/f/about" target="_blank">摩托</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">329.5k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1300379737@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1300379737" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1300379737" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/f/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/f/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/f/libs/materialize/materialize.min.js"></script>
    <script src="/f/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/f/libs/aos/aos.js"></script>
    <script src="/f/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/f/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/f/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/f/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/f/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/f/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
